<html>

<head>
<title>Public Transport Router</title>
    <script src="lib/jquery-1.12.4.js"></script>
    <script src="lib/jquery-ui.js"></script>
    <script src="AutoComplete.js"></script>
    <script src="RoutePlanningScript.js"></script>

    <link rel="stylesheet" href="lib/jquery-ui.css">
    
    <script type="text/javascript" src="lib/jquery.timepicker.js"></script>
    <link rel="stylesheet" type="text/css" href="lib/jquery.timepicker.css" />

    <script>
    $(function(){
        $("#header").load("header.html");
        $("#footer").load("footer.html"); 
    });
    </script>

    
<head>


<body>
<header id="header"></header>
<div class="content">

<form autocomplete="off" onsubmit="loadJourneys()">
<table>
<tr><td>
<table>
<tr><td>
<td>From</td><td><span class="autocomplete"><input type="text" id="from" name="from"></span></td>
<td>To</td><td><span class="autocomplete"><input type="text" id="to" name="to"></span></td>

</tr>
<tr>
<td>
<td>Date</td><td><input type="text" id="depDate" name="depDate"></td>
<td>Time</td><td><input type="text" id="depTime" name="depTime"></td>
</tr>
</table>
</form>

<td>
<button onclick="loadJourneys()" type="button">Search journeys</button>
</td></tr>
</table>

<div id="journeys">

<details>
<summary>Journey<a>test</a></summary>
<p>More details<p>
</details>
</div>


</head>
<body>
 
<script>

/**** Input setup *****/
$( function() {
    $( "#depDate" ).datepicker({dateFormat: "yy-mm-dd"});
    $( "#depDate" ).datepicker("setDate", new Date());
  } );
  
$('#depTime').timepicker({'timeFormat': 'H:i', 'step':5});
$('#depTime').timepicker('setTime', new Date());


function suggestStations(val, callback){
    searchStation(val, function(data){
        var arr = [];
        var tags = [];
        for(i in data){
            arr.push(data[i].name);
            tags.push(data[i].id);
        }
        callback(arr, tags);
    });
}

autocomplete(document.getElementById("from"), suggestStations);
autocomplete(document.getElementById("to"), suggestStations);

document.getElementById("from").focus();



function renderJourneys(journeys){
    console.log(journeys);
    
}
    

function loadJourneys(){
    let fromId = document.getElementById("from").hiddenValue;
    let toId = document.getElementById("to").hiddenValue;
    if(fromId === undefined || toId === undefined){
        alert("Please, specify a departure and arrival station");
    }
    
    console.log(document.getElementById('depDate').value)
    console.log(document.getElementById('depTime').value)
    
    var depTime = document.getElementById('depDate').value + " "+document.getElementById('depTime').value+'+01:00';
    var date = new Date(depTime).toISOString();
    
    console.log(date);
    function onFail(){
        alert("Looking up the journey failed. Perhaps you tried searching a lot in the past of the future?")
    }
    

    
    lookupJourney(fromId, toId, date, 180, renderJourneys, onFail)
    
}

</script>



</div>
<footer id="footer"></footer>
</body>

</html>
